//https://leetcode.com/contest/biweekly-contest-161/problems/network-recovery-pathways
class Solution {
public:
    int findMaxPathScore(vector<vector<int>>& edges, vector<bool>& online, long long k) {
        vector<vector<pair<int, int>>> adj_list(online.size());

        for(auto e: edges){
            if(online[e[0]] && online[e[1]]){
                adj_list[e[0]].push_back({e[1], e[2]});//node, cost
            }
        }
        
        queue<tuple<int, int, long long>> s;//node, min_val, sum
        int maxVal = INT_MIN;
        s.push({0, INT_MAX, 0});
        unordered_map<int, unordered_map<int, long long>> m_visit;//node, min_val, cost
        while(!s.empty()){
            auto [node, min_val, total] = s.front();
            s.pop();
            if(total > k)
                continue;
            if(node == online.size()-1){//dest
                maxVal = max(maxVal, min_val);
                continue;
            }
            if(m_visit[node].count(min_val) && m_visit[node][min_val] <= total)
                continue;
            m_visit[node][min_val] = total;
            
            for(int i=0; i<adj_list[node].size(); i++){
                int n_node = adj_list[node][i].first;
                int cost = adj_list[node][i].second;
                s.push({n_node, min(min_val, cost), total+cost});
            }
        }

        return (maxVal == INT_MIN)? -1:maxVal;
    }
};

// [[9,18,105],[17,36,241],[16,28,34],[18,40,794],[27,44,294],[27,34,746],[14,43,398],[7,37,444],[10,22,434],[19,37,828],[26,31,430],[3,14,553],[33,42,287],[7,36,302],[20,31,869],[30,38,537],[21,27,331],[22,30,222],[30,39,429],[31,39,165],[38,40,357],[3,41,848],[41,42,948],[31,34,887],[38,39,806],[15,18,995],[1,5,90],[25,42,465],[18,41,248],[32,44,211],[3,13,578],[25,39,734],[40,42,398],[12,22,271],[16,36,376],[23,33,112],[11,12,563],[18,39,109],[41,44,315],[38,43,789],[31,33,443],[29,39,555],[10,11,805],[41,43,561],[26,29,901],[19,36,490],[43,44,845],[17,31,77],[23,27,818],[14,16,838],[31,42,161],[29,30,209],[37,39,537],[39,44,559],[12,24,10],[23,34,512],[33,40,932],[31,43,681],[14,29,946],[42,44,909],[1,25,299],[0,28,805],[19,28,549],[3,16,780],[30,31,787],[23,32,107],[42,43,590],[5,29,379],[19,22,710],[20,32,666],[34,43,126],[32,40,787],[22,39,18],[36,42,855],[26,30,505],[0,7,383],[36,39,518],[2,39,56],[22,25,368],[5,24,806],[1,36,708],[39,43,679],[33,37,858],[34,44,878],[5,25,691],[5,15,142],[26,42,211],[2,5,64],[11,16,762],[8,44,181],[16,25,664],[32,35,419],[15,29,468],[16,27,678],[25,34,724],[16,44,300],[1,30,465],[31,38,75],[29,31,699],[34,42,96],[27,31,391],[2,10,614],[30,32,200],[21,22,851],[22,27,242],[3,5,249],[0,29,287],[7,23,427],[32,43,211],[31,37,611],[39,41,862],[33,44,498],[28,30,654],[2,31,266],[36,43,686],[36,44,226],[0,30,455],[12,18,559],[0,5,336],[20,29,294],[18,42,340],[2,19,423],[13,34,264],[37,44,276],[38,42,697],[20,38,389],[27,43,781],[14,35,33],[34,39,403],[27,42,484],[34,35,323],[19,33,297],[36,38,835],[0,42,530],[6,41,230],[14,31,820],[19,39,669],[33,35,932],[25,33,453],[3,36,405],[13,32,69],[31,40,11],[4,15,483],[32,41,44],[20,34,205],[36,41,169],[6,36,398],[28,41,956],[19,42,310],[10,18,66],[8,17,484],[37,40,759],[15,23,397],[12,38,286],[17,30,132],[40,41,224],[17,44,161],[16,34,741],[27,29,547],[17,39,680],[21,26,272],[37,41,139],[30,34,182],[33,41,217],[6,17,760],[6,44,249],[3,44,919],[17,40,911],[4,44,687],[13,41,42],[37,38,390],[12,25,611],[11,38,308],[24,31,169],[19,31,566],[6,22,102],[22,41,248],[12,41,521],[39,40,50],[40,44,279],[27,32,542],[23,41,415],[28,34,445],[11,36,537],[26,37,334],[9,37,453],[13,36,389],[15,43,391],[25,26,197],[10,15,207],[38,44,115],[29,33,242],[13,35,257],[20,33,100],[34,41,921],[18,32,738],[23,40,870],[12,44,894],[15,27,213],[31,32,886],[4,14,696],[6,9,738],[20,27,278],[9,35,185],[1,34,919],[8,21,795],[34,40,214],[4,32,291],[17,28,223],[0,22,201],[8,36,89],[9,16,92],[26,32,185],[32,36,936],[6,40,981],[13,20,365],[32,34,347],[36,37,98],[2,42,555],[5,44,587],[18,26,926],[25,36,766],[10,37,885],[39,42,205],[17,41,175],[17,34,929],[5,7,44],[14,40,949],[0,33,538],[27,28,984],[34,38,232],[7,31,284],[6,30,609],[24,42,159],[19,26,862],[27,41,105],[14,15,49],[15,35,868],[22,33,870],[36,40,254],[24,34,949],[22,34,277],[24,28,649],[9,28,223],[14,27,530],[5,23,364],[25,27,584],[37,42,588],[11,32,205],[19,32,553],[8,11,797],[15,28,993],[22,36,960],[12,30,633],[26,39,546],[0,18,105],[13,31,919],[35,41,46],[0,1,361],[4,22,882],[23,29,965],[0,24,507],[7,14,263],[17,25,404],[8,35,234],[29,32,988],[10,38,513],[6,14,699],[23,28,576],[34,36,641],[19,24,194],[24,32,499],[10,36,360],[32,37,507],[16,18,849],[18,30,708],[8,28,702],[8,38,869],[22,32,300],[9,39,6],[15,16,782],[0,4,350],[25,29,893],[5,27,382],[5,6,550],[8,13,985],[13,38,553],[22,44,906],[19,38,767],[11,30,65],[24,43,468],[16,39,897],[15,32,879],[30,42,323],[15,20,881],[34,37,725],[20,26,152],[28,29,45],[20,30,774],[13,29,548],[8,30,304],[35,42,629],[23,35,296],[24,33,538],[0,27,838],[22,23,578],[6,32,70],[4,16,888],[4,5,245],[28,40,368],[19,20,842],[3,15,105],[15,37,35],[10,16,362],[13,30,895],[5,26,640],[22,38,303],[10,20,802],[9,40,589],[1,4,311],[0,11,996],[1,39,407],[4,33,726],[18,29,506],[24,41,20],[3,18,648],[30,43,695],[25,41,745],[10,33,919],[8,31,663],[29,35,210],[14,22,877],[6,31,695],[22,31,462],[16,26,682],[21,33,598],[18,31,302],[7,32,421],[8,22,603],[28,39,409],[7,8,588],[2,24,16],[27,40,988],[3,30,827],[29,41,138],[12,14,797],[24,25,48],[8,15,549],[27,37,223],[4,13,880],[21,31,798],[25,35,955],[1,18,751],[28,35,168],[24,44,690],[26,33,573],[22,29,68],[1,14,519],[22,35,974],[1,23,949],[16,32,767],[15,24,473],[7,20,540],[5,32,66],[30,37,300],[2,13,991],[21,34,843],[4,36,648],[0,44,688],[2,28,985],[24,37,802],[8,33,829],[12,19,945],[1,6,816],[10,14,175],[6,43,270],[25,31,671],[18,36,657],[7,26,830],[35,39,446],[35,43,483],[5,39,499],[13,15,774],[15,34,241],[8,26,956],[19,27,819],[15,19,756],[29,40,301],[23,37,34],[4,10,580],[5,20,487],[18,34,296],[23,31,809],[8,32,449],[16,41,506],[15,44,270],[31,41,53],[37,43,969],[38,41,965],[25,38,707],[21,25,416],[32,39,593],[3,8,404],[31,36,83],[33,34,824],[28,33,862],[20,24,205],[20,40,62],[5,13,617],[18,28,443],[2,30,160],[31,44,117],[11,29,156],[13,23,257],[21,32,556],[6,27,952],[9,44,456],[15,38,915],[14,30,631],[12,36,476],[3,27,554],[8,34,887],[16,29,615],[12,27,777],[0,36,328],[27,33,589],[12,26,506],[8,27,870],[5,11,941],[3,9,907],[2,15,929],[10,34,926],[9,26,938],[14,41,719],[8,42,993],[35,36,18],[10,23,337],[5,30,999],[26,38,402],[2,21,254],[11,27,179],[1,44,325],[6,16,531],[16,17,166],[21,35,370],[0,9,511],[5,31,551],[4,31,422],[8,10,928],[20,43,48],[17,35,789],[20,42,799],[21,39,452],[22,28,568],[20,23,124],[33,43,879],[25,43,352],[30,44,125],[33,38,538],[6,39,390],[19,21,851],[21,44,319],[9,14,22],[10,24,65],[26,40,602],[11,42,501],[1,42,698],[3,22,257],[1,35,454],[15,33,951],[1,12,877],[13,24,892],[15,42,931],[5,40,268],[28,44,50],[1,7,422],[20,35,829],[26,43,227],[18,38,319],[1,43,306],[30,36,436],[16,43,475],[4,21,755],[16,22,778],[17,20,41],[9,33,23],[7,27,849],[10,26,160],[17,33,157],[12,34,531],[3,34,958],[28,37,948],[23,36,725],[22,26,670],[30,40,861],[2,40,28],[0,19,929],[21,40,585],[10,30,857],[10,13,433],[6,10,858],[7,21,680],[17,24,183],[3,7,592],[16,33,851],[16,42,751],[16,40,464],[29,44,539],[26,36,1000],[8,25,535],[0,43,129],[7,17,922],[3,42,297],[20,39,793],[21,41,962],[28,42,918],[19,35,587],[20,28,622],[24,30,189],[12,39,667],[18,44,904],[11,26,295],[21,36,602],[6,12,971],[32,42,149],[18,21,594],[22,40,378],[11,13,677],[23,38,1000],[1,9,354],[13,33,465],[35,38,274],[17,38,459],[5,17,539],[28,38,17],[30,35,179],[9,15,750],[5,36,283],[11,14,911],[13,40,677],[12,31,564],[5,42,515],[14,36,388],[29,42,549],[13,14,557],[26,41,448],[10,42,902],[4,26,103],[13,25,347],[8,40,928],[12,16,233],[10,35,285],[8,29,283],[5,10,773],[19,44,887],[7,11,802],[0,41,556],[4,24,995],[1,24,44],[12,40,136],[14,28,514],[23,24,334],[20,25,128],[4,20,361],[3,40,599],[2,9,164],[21,42,641],[9,24,552],[10,25,218],[10,21,6],[27,38,284],[15,17,882],[35,37,242],[3,25,358],[29,36,228],[26,44,520],[15,25,170],[3,11,655],[33,39,641],[24,27,80],[9,22,703],[7,33,475],[22,24,70],[3,17,429],[14,21,106],[3,28,673],[10,39,38],[8,14,681],[12,29,431],[8,19,352],[2,20,809],[14,37,333],[1,21,497],[21,28,53],[33,36,11],[27,30,305],[4,43,421],[28,32,106],[18,23,78],[19,25,915],[15,36,273],[19,30,90],[11,18,770],[15,26,758],[1,40,715],[14,42,289],[7,13,595],[21,23,868],[7,12,25],[8,12,549],[40,43,265],[6,15,864],[19,29,348],[32,38,376],[18,20,40],[26,34,667],[17,18,200],[4,7,5],[10,31,308],[6,24,510],[11,40,7],[0,23,14],[16,24,704],[10,19,597],[6,7,602],[11,15,727],[28,31,504],[14,20,362],[12,21,592],[2,17,244],[30,33,96],[3,26,400],[1,20,402],[2,27,872],[25,44,207],[22,37,136],[24,35,578],[12,35,266],[5,16,696],[26,35,593],[1,3,945],[9,34,771],[20,21,558],[13,19,661],[26,28,96],[8,20,456],[25,30,336],[15,31,975],[9,32,502],[6,33,674],[2,34,234],[8,16,550],[7,43,366],[9,13,750],[23,43,648],[9,41,484],[24,29,967],[6,42,934],[14,25,307],[0,10,58],[4,12,759],[15,40,659],[0,14,656],[13,16,377],[11,22,181],[2,6,705],[10,32,999],[16,30,260],[29,37,574],[19,43,803],[8,23,163],[15,30,830],[2,11,935],[6,26,28],[29,38,209],[11,28,760],[6,34,210],[9,11,29],[10,27,28],[25,32,244],[4,11,565],[13,27,595],[11,20,609],[5,18,250],[7,38,18],[4,23,47],[23,26,413],[0,16,772],[3,24,662],[20,44,107],[14,33,509],[9,10,498],[18,25,837],[2,32,722],[17,22,401],[17,43,614],[6,38,901],[21,24,681],[14,34,113],[1,37,380],[6,13,994],[9,20,526],[2,3,806],[12,17,156],[1,22,346],[16,38,54],[16,31,629],[2,43,489],[20,41,704],[18,43,663],[4,35,926],[2,23,892],[11,31,952],[6,23,955],[9,36,615],[7,10,899],[32,33,720],[5,21,141],[3,31,457],[3,12,723],[13,39,523],[13,22,905],[10,29,919],[3,20,197],[4,19,384],[10,12,997],[25,40,41],[7,22,411],[8,9,751],[10,40,209],[9,30,347],[10,44,64],[4,30,113],[2,4,878],[0,15,736],[24,26,404],[24,38,708],[17,37,496],[11,24,640],[11,23,481],[16,21,869],[13,37,320],[12,33,455],[9,27,769],[7,44,832],[27,36,786],[11,33,676],[19,34,220],[35,44,119],[30,41,957],[1,33,624],[7,15,196],[22,42,438],[16,20,566],[11,34,813],[2,14,172],[1,27,863],[11,25,48],[21,43,475],[1,32,909],[7,30,345],[9,25,47],[0,2,331],[17,42,397],[18,24,179],[0,21,948],[5,41,607],[6,21,78]]
// [true,true,true,true,true,true,true,true,true,true,true,true,false,true,true,false,false,true,false,true,true,true,false,true,true,true,true,true,true,true,false,true,true,false,true,true,true,false,true,true,true,true,true,true,true]
// 8604
// [[4,11,650],[25,30,233],[18,31,105],[24,30,296],[30,33,829],[18,26,98],[2,28,178],[33,34,925],[21,23,951],[19,32,453],[23,34,307],[30,32,404],[21,33,133],[4,29,930],[4,27,126],[26,27,661],[9,22,660],[21,25,846],[13,24,779],[2,30,406],[3,4,505],[18,23,713],[3,5,895],[20,31,398],[15,23,500],[32,34,91],[6,28,441],[17,21,446],[26,28,128],[30,34,406],[17,19,532],[12,32,526],[6,7,86],[10,15,730],[7,33,272],[27,29,14],[0,13,935],[15,26,752],[20,23,382],[32,33,730],[17,18,911],[8,12,636],[1,28,353],[24,27,791],[29,32,173],[15,31,74],[26,32,998],[11,28,15],[25,27,64],[12,34,916],[12,26,883],[3,15,731],[9,18,339],[10,20,877],[9,26,324],[13,31,321],[0,25,24],[25,34,894],[9,21,238],[9,23,277],[10,12,628],[9,31,854],[23,30,647],[20,24,837],[11,25,914],[20,22,703],[22,23,879],[5,30,367],[10,11,18],[7,16,306],[8,11,603],[31,32,956],[23,33,138],[10,17,649],[9,24,938],[7,26,947],[14,34,539],[4,17,330],[11,27,861],[11,30,430],[17,29,584],[5,9,353],[24,29,172],[9,16,78],[28,30,593],[29,33,126],[8,27,946],[3,17,241],[10,26,651],[24,31,798],[14,23,377],[16,30,919],[23,32,966],[7,29,489],[15,24,527],[13,32,612],[21,34,946],[12,22,873],[16,33,623],[27,30,633],[4,8,149],[18,34,679],[18,21,589],[4,5,236],[13,29,316],[14,33,263],[7,27,881],[20,30,529],[4,19,865],[3,16,828],[29,30,416],[25,33,734],[12,16,494],[11,29,583],[26,31,574],[16,32,550],[26,34,877],[20,27,526],[9,32,994],[20,26,762],[19,29,49],[31,34,399],[28,34,235],[13,30,447],[31,33,736],[21,24,132],[1,9,670],[14,28,528],[25,32,160],[14,22,247],[24,33,307],[20,29,369],[22,31,509],[18,33,495],[2,19,920],[28,31,77],[19,34,398],[19,20,703],[23,24,905],[3,31,592],[5,21,479],[20,28,818],[13,27,955],[19,28,342],[1,5,123],[8,28,280],[2,34,552],[8,34,287],[26,29,323],[1,31,186],[20,25,455],[1,18,98],[27,31,650],[6,25,285],[15,16,574],[29,34,457],[25,29,149],[25,28,48],[17,20,437],[14,18,252],[22,28,888],[27,34,604],[9,14,473],[11,19,146],[10,23,13],[4,34,56],[15,34,7],[5,6,161],[1,17,536],[26,33,392],[27,32,509],[9,17,420],[14,21,75],[1,29,881],[13,15,506],[23,26,919],[17,22,175],[18,29,769],[16,26,861],[14,20,29],[28,32,745],[1,3,68],[8,19,606],[8,20,75],[4,24,736],[16,20,730],[25,31,771],[21,22,708],[6,32,362],[12,33,807],[21,32,48],[15,33,929],[17,24,103],[4,28,702],[23,27,717],[13,25,832],[14,17,513],[0,4,881],[7,28,986],[2,29,298],[13,26,540],[10,24,781],[12,21,755],[11,21,537],[27,33,583],[1,21,634],[22,25,981],[29,31,560],[8,32,785],[23,25,747],[10,13,574],[12,14,573],[18,32,680],[14,29,334],[3,13,68],[30,31,762],[4,9,994],[3,28,385],[18,28,951],[3,27,149],[0,18,155],[12,31,763],[3,18,434],[12,13,715],[6,9,408],[1,11,819],[1,19,812],[17,25,300],[0,14,151],[16,28,273],[2,5,729],[27,28,702],[19,33,618],[18,22,405],[2,17,864],[13,33,165],[4,18,419],[7,20,837],[22,26,211],[1,2,930],[7,30,245],[6,29,921],[13,16,839],[10,16,926],[4,16,266],[8,31,470],[17,28,521],[7,24,118],[5,29,705],[14,30,784],[8,33,29],[8,26,463],[8,23,955],[0,3,802],[5,10,525],[4,25,729],[24,34,103],[5,25,966],[10,34,988],[11,14,918],[6,21,202],[6,26,440],[7,17,990],[12,17,792],[16,21,395],[1,27,205],[8,18,882],[0,30,650],[2,24,416],[15,22,583],[6,34,750],[22,27,105],[1,22,62],[5,12,610],[12,20,937],[2,15,857],[8,16,106],[3,9,295],[16,27,720],[26,30,166],[10,30,778],[8,25,185],[13,17,597],[19,31,253],[1,33,72],[15,29,80],[19,21,373],[1,4,467],[17,34,968],[16,24,859],[21,26,705],[18,25,324],[8,14,599],[2,10,860],[8,10,900],[3,22,158],[5,33,318],[12,25,276],[13,14,575],[11,26,999],[7,22,535],[24,32,111],[16,22,852],[19,23,140],[10,27,511],[8,21,768],[5,28,531],[6,16,928],[12,27,151],[2,23,830],[11,12,994],[4,21,88],[5,23,33],[13,23,186],[6,12,577],[3,21,250],[21,31,119],[28,29,451],[2,6,582],[11,24,524],[2,14,500],[7,21,277],[16,34,763],[20,34,33],[2,9,524],[5,24,433],[3,11,549],[9,27,956],[11,17,417],[4,31,497],[25,26,293],[24,28,385],[15,32,691],[3,12,506],[6,31,61],[11,18,628],[17,30,680],[5,19,369],[8,17,130],[2,31,687],[4,6,78],[4,13,463],[19,25,935],[9,15,595],[0,20,118],[3,25,831],[13,21,363],[6,19,124],[0,26,65],[12,19,372],[22,29,266],[4,22,271],[10,29,983],[13,19,2],[19,27,15],[18,30,347],[6,15,934],[10,19,524],[0,23,793],[0,27,620],[21,27,514],[10,28,140],[24,26,826],[14,25,989],[13,18,85],[6,27,972],[11,16,275],[19,24,16],[15,30,955],[2,25,517],[13,22,203],[12,23,715],[24,25,646],[14,24,500],[20,32,219],[10,32,619],[11,34,680],[11,13,88],[6,20,823],[17,27,430],[1,7,317],[0,24,138],[0,29,15],[9,25,231],[17,31,746],[5,8,398],[8,22,199],[6,23,648],[23,28,933],[9,33,820],[6,18,562],[22,32,847],[8,9,555],[7,12,418],[20,33,349],[21,29,438],[23,31,80],[6,30,339],[19,26,44],[2,12,672],[0,22,770],[13,28,208],[28,33,841],[5,15,439],[9,20,895],[9,10,670],[16,31,878],[14,26,703],[10,31,575],[0,15,196],[0,11,359],[21,28,403],[7,34,317],[15,25,327],[10,22,205],[1,25,35],[2,27,641],[1,8,805],[14,15,359],[0,9,161],[9,30,703],[3,19,692],[6,24,392],[3,7,99],[6,14,996],[0,12,720],[3,24,473],[3,33,202],[2,26,562],[12,24,279],[15,20,2],[16,29,476],[20,21,442],[19,30,754],[0,19,897],[16,25,496],[5,11,399],[1,13,312],[14,31,161],[23,29,257],[11,15,564],[3,26,416],[5,16,994],[22,33,714],[2,33,380],[15,28,473],[4,14,85],[1,32,873],[5,31,821],[17,33,357],[0,16,13],[4,10,228],[1,20,91],[5,14,497],[3,23,680],[2,20,903],[13,34,858],[18,24,680],[4,20,16],[2,11,134],[10,21,323],[15,17,501],[2,22,827],[1,24,423],[5,32,1000],[9,12,171],[7,18,873],[11,32,346],[11,31,922],[9,34,291],[5,27,283],[14,16,91],[1,10,172],[2,16,692],[14,19,255],[7,14,787],[19,22,529],[21,30,22],[18,19,141],[8,30,363],[1,26,914],[16,23,382],[7,25,452],[7,23,717],[14,32,70],[12,28,945],[3,29,159],[15,21,167],[15,19,647],[22,30,935],[14,27,501],[2,7,800],[17,32,781],[7,32,939],[22,34,801],[9,29,533],[15,27,977],[9,13,115],[4,15,16],[2,21,400],[17,23,713],[5,7,508],[4,33,43],[7,11,72],[3,6,356],[18,27,304],[4,12,854],[6,33,45],[6,11,689],[3,34,334],[18,20,63],[17,26,32],[16,19,444],[5,22,589],[2,13,446],[6,22,849],[7,15,759],[0,5,63],[12,18,981],[9,19,604],[8,29,200],[12,30,554],[1,6,384]]
// [true,true,true,true,false,true,true,false,true,true,true,true,true,true,true,true,true,false,false,true,false,true,true,true,true,false,false,true,true,true,true,true,true,true,true]
// 7137
